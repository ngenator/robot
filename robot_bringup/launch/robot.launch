<launch>
  <arg name="robot_address" default="192.168.98.234"/>
  <arg name="robot_user"    default="ngenator"/>

  <arg name="urdf_file" default="$(find xacro)/xacro --inorder '$(find robot_description)/robots/kobuki_hexagons_r200.urdf.xacro'"/>
  <param name="robot_description" command="$(arg urdf_file)"/>

  <machine name="robot" address="$(arg robot_address)" user="$(arg robot_user)" env-loader="/opt/ros/env.sh" default="true"/>

  <group>
    <!-- Start the driver for the mobile base -->
    <node pkg="nodelet" type="nodelet" name="mobile_base_nodelet_manager" args="manager" machine="robot"/>
    <node pkg="nodelet" type="nodelet" name="mobile_base" args="load kobuki_node/KobukiNodelet mobile_base_nodelet_manager" machine="robot">
      <rosparam file="$(find kobuki_node)/param/base.yaml" command="load"/>
    </node>

    <node pkg="diagnostic_aggregator" type="aggregator_node" name="diagnostic_aggregator" machine="robot">
      <rosparam command="load" file="$(find kobuki_node)/param/diagnostics.yaml"/>
    </node>

    <node pkg="robot_state_publisher" type="robot_state_publisher" name="robot_state_publisher" machine="robot">
      <param name="publish_frequency" type="double" value="30.0"/>
    </node>

    <node name="joint_state_publisher" pkg="joint_state_publisher" type="joint_state_publisher" machine="robot"/>

    <!-- Additional sensors: enable_lidar, enable_depth -->
    <group>
      <include file="$(find robot_bringup)/launch/includes/robot/sensors/rplidar.launch"/>
      <include file="$(find robot_bringup)/launch/includes/robot/sensors/d435.launch"/>
    </group>
  </group>
</launch>