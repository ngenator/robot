<launch>
  <arg name="robot_name" default="robot"/>
  
  <arg name="urdf_file" default="$(find xacro)/xacro --inorder '$(find turtlebot_description)/robots/kobuki_hexagons_r200.urdf.xacro'" />
  <param name="robot_description" command="$(arg urdf_file)" />
  
  <node name="mobile_base_nodelet_manager" pkg="nodelet" type="nodelet" args="manager"                                                    machine="$(arg robot_name)"/>
  <node name="mobile_base"                 pkg="nodelet" type="nodelet" args="load kobuki_node/KobukiNodelet mobile_base_nodelet_manager" machine="$(arg robot_name)">
    <rosparam command="load" file="$(find robot_driver)/param/kobuki/mobile_base.yaml"/>
  </node>

  <node name="diagnostic_aggregator" pkg="diagnostic_aggregator" type="aggregator_node" machine="$(arg robot_name)">
    <rosparam command="load" file="$(find robot_driver)/param/kobuki/diagnostics.yaml" />
  </node>

  <node name="robot_state_publisher" pkg="robot_state_publisher" type="robot_state_publisher" machine="$(arg robot_name)">
    <param name="publish_frequency" type="double" value="5.0" />
    
    <remap from="joint_states" to="mobile_base/joint_states"/>
  </node>

  <node name="robot_velocity_smoother" pkg="nodelet" type="nodelet" args="load yocs_velocity_smoother/VelocitySmootherNodelet mobile_base_nodelet_manager" machine="$(arg robot_name)">
    <rosparam file="$(find robot_driver)/param/defaults/smoother.yaml" command="load"/>
    
    <remap from="robot_velocity_smoother/smooth_cmd_vel" to="mobile_base/commands/velocity"/>

    <remap from="robot_velocity_smoother/odometry"      to="mobile_base/odom"/>
    <remap from="robot_velocity_smoother/robot_cmd_vel" to="mobile_base/commands/velocity"/>
  </node>

  <node pkg="nodelet" type="nodelet" name="bumper2pointcloud" args="load kobuki_bumper2pc/Bumper2PcNodelet mobile_base_nodelet_manager" machine="$(arg robot_name)">
      <param name="pointcloud_radius" value="0.24"/>

      <remap from="bumper2pointcloud/pointcloud"   to="mobile_base/sensors/bumper_pointcloud"/>
      <remap from="bumper2pointcloud/core_sensors" to="mobile_base/sensors/core"/>
  </node>
</launch>
