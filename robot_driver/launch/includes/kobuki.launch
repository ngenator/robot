<launch>
  <arg name="robot_name" default="robot"/>
  
  <arg name="urdf_file" default="$(find xacro)/xacro --inorder '$(find turtlebot_description)/robots/kobuki_hexagons_r200.urdf.xacro'" />
  <param name="robot_description" command="$(arg urdf_file)" />
  
  <node pkg="nodelet" type="nodelet" name="$(arg robot_name)_nodelet_manager" args="manager" machine="$(arg robot_name)"/>
  
  <node pkg="nodelet" type="nodelet" name="$(arg robot_name)" args="load kobuki_node/KobukiNodelet $(arg robot_name)_nodelet_manager" machine="$(arg robot_name)">
    <rosparam command="load" file="$(find robot_driver)/param/kobuki/mobile_base.yaml"/>
  </node>

  <node pkg="nodelet" type="nodelet" name="bumper_pointcloud" args="load kobuki_bumper2pc/Bumper2PcNodelet $(arg robot_name)_nodelet_manager" machine="$(arg robot_name)">
      <param name="pointcloud_radius" type="double" value="0.24"/>

      <remap from="bumper_pointcloud/pointcloud"   to="$(arg robot_name)/sensors/bumper"/>
      <remap from="bumper_pointcloud/core_sensors" to="$(arg robot_name)/sensors/core"/>
  </node>

  <node pkg="diagnostic_aggregator" type="aggregator_node" name="diagnostic_aggregator" machine="$(arg robot_name)">
    <rosparam command="load" file="$(find robot_driver)/param/kobuki/diagnostics.yaml"/>
    
    <!-- Set the prefixes to remove using the robot_name arg -->
    <rosparam param="analyzers/power/remove_prefix"       subst_value="true">$(arg robot_name)_nodelet_manager</rosparam>
    <rosparam param="analyzers/kobuki/remove_prefix"      subst_value="true">$(arg robot_name)_nodelet_manager</rosparam>
    <rosparam param="analyzers/sensors/remove_prefix"     subst_value="true">$(arg robot_name)_nodelet_manager</rosparam>
    <rosparam param="analyzers/input_ports/remove_prefix" subst_value="true">$(arg robot_name)_nodelet_manager</rosparam>
  </node>

  <node pkg="robot_state_publisher" type="robot_state_publisher" name="robot_state_publisher" machine="$(arg robot_name)">
    <param name="publish_frequency" type="double" value="5.0" />

    <remap from="joint_states" to="$(arg robot_name)/joint_states"/>
  </node>
</launch>
